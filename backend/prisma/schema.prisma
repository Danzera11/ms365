generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ==========================================
// MODELO PRINCIPAL DO PROJETO
// ==========================================
//

model Projeto {
  id              String          @id @default(cuid())
  nome            String
  clienteId       String
  cliente         Client          @relation(fields: [clienteId], references: [id])
  descricao       String?
  status          String          @default("planejamento") // planejamento, andamento, concluído
  progresso       Int             @default(0)              // % concluído
  dataCriacao     DateTime        @default(now())
  dataAtualizacao DateTime        @updatedAt

  // Relacionamentos com módulos
  levantamento    Levantamento[]
  usuarios        Usuario[]
  emailConfig     EmailConfig?
  sharepoint      SharePointSite[]
  teams           TeamsConfig?
  cronograma      CronogramaItem[]
  licenciamento   Licenciamento?
  orientacoes     Orientacao?

  logs            LogProjeto[]
}

//
// ==========================================
// CLIENTE / ANALISTA
// ==========================================
//

model Analyst {
  id        String         @id @default(cuid())
  nome      String
  email     String         @unique
  senha     String
  papel     String         @default("analista") // analista ou cliente
  criadoEm  DateTime       @default(now())
  atualizadoEm DateTime    @updatedAt

  logs      DecisionLog[]
}

model Client {
  id        String          @id @default(cuid())
  nome      String
  dominio   String          @unique
  segmento  String
  criadoEm  DateTime        @default(now())
  atualizadoEm DateTime     @updatedAt

  projetos  Projeto[]
  deployments Deployment[]
}

//
// ==========================================
// LOGS (AUDITORIA)
// ==========================================
//

model DecisionLog {
  id            String     @id @default(cuid())
  analistaId    String
  analista      Analyst    @relation(fields: [analistaId], references: [id])
  deploymentId  String
  deployment    Deployment @relation(fields: [deploymentId], references: [id])
  descricao     String
  criadoEm      DateTime   @default(now())
}

model LogProjeto {
  id        String     @id @default(cuid())
  projetoId String
  projeto   Projeto    @relation(fields: [projetoId], references: [id])
  mensagem  String
  criadoEm  DateTime   @default(now())
}

//
// ==========================================
// DEPLOYMENTS (SUA IMPLANTAÇÃO ANTIGA)
// ==========================================
//

model Deployment {
  id             String        @id @default(cuid())
  clientId       String
  client         Client        @relation(fields: [clientId], references: [id])
  modelSelected  String
  licensing      String
  status         String        @default("planejamento")
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  decisions      DecisionLog[]
}

//
// ==========================================
// LEVANTAMENTO — 14 serviços Microsoft 365
// ==========================================
//

model Levantamento {
  id            String   @id @default(cuid())
  projetoId     String
  projeto       Projeto  @relation(fields: [projetoId], references: [id])

  nome          String
  categoria     String
  criticidade   String
  tempoEstimado Int      // em horas ou semanas
  selecionado   Boolean  @default(false)
  observacoes   String?
}

//
// ==========================================
// USUÁRIOS — Dados para migração
// ==========================================
//

model Usuario {
  id          String   @id @default(cuid())
  projetoId   String
  projeto     Projeto  @relation(fields: [projetoId], references: [id])

  nome        String
  departamento String?
  cargo       String?
  email       String
  caixaMB     Int?

  officeLocal Boolean  @default(false)
  migrarEmail Boolean  @default(false)
  oneDrive    Boolean  @default(false)
  sharePoint  Boolean  @default(false)
  teams       Boolean  @default(false)

  criadoEm    DateTime @default(now())
}

//
// ==========================================
// E-MAIL — Metodologia de Migração
// ==========================================
//

model EmailConfig {
  id            String   @id @default(cuid())
  projetoId     String   @unique
  projeto       Projeto  @relation(fields: [projetoId], references: [id])

  plataformaOrigem String
  metodologia      String?
  janelaMigracao   String?
  volumeTotalMB    Int?

  migrarCalendarios Boolean @default(true)
  migrarContatos    Boolean @default(true)
  backupPst         Boolean @default(false)

  caixasCompartilhadas String?
  gruposDistribuicao   String?

  observacoes String?
}

//
// ==========================================
// SHAREPOINT — Sites, bibliotecas e volumes
// ==========================================
//

model SharePointSite {
  id            String   @id @default(cuid())
  projetoId     String
  projeto       Projeto  @relation(fields: [projetoId], references: [id])

  nome          String
  tipo          String  // Comunicação, Teams, Biblioteca
  proposito     String?
  proprietarios String?
  membros       String?
  nivelAcesso   String?
  volumeGB      Float?
  pastaOrigem   String?
}

//
// ==========================================
// TEAMS — Configuração completa
// ==========================================
//

model TeamsConfig {
  id              String   @id @default(cuid())
  projetoId       String   @unique
  projeto         Projeto  @relation(fields: [projetoId], references: [id])

  nomeEquipe      String?
  tipoEquipe      String?
  proposito       String?
  proprietarios   String?
  membrosIniciais String?
  canais          String?
  recursos        String? // JSON serializado
  observacoes     String?
}

//
// ==========================================
// CRONOGRAMA — Etapas do projeto
// ==========================================
//

model CronogramaItem {
  id            String    @id @default(cuid())
  projetoId     String
  projeto       Projeto   @relation(fields: [projetoId], references: [id])

  nome          String
  responsavel   String?
  inicio        DateTime?
  fim           DateTime?
  status        String     @default("não iniciado")
  ordem         Int?
}

//
// ==========================================
// LICENCIAMENTO
// ==========================================
//

model Licenciamento {
  id              String   @id @default(cuid())
  projetoId       String   @unique
  projeto         Projeto  @relation(fields: [projetoId], references: [id])

  m365basic       Int?     @default(0)
  m365standard    Int?     @default(0)
  appsforbusiness Int?     @default(0)
  f3              Int?     @default(0)
  e3              Int?     @default(0)
  e5              Int?     @default(0)

  observacoes     String?
}

//
// ==========================================
// ORIENTAÇÕES NITRO (CONTEÚDO ESTÁTICO)
// ==========================================
//

model Orientacao {
  id          String   @id @default(cuid())
  projetoId   String   @unique
  projeto     Projeto  @relation(fields: [projetoId], references: [id])

  teams       String?  // Texto HTML enorme com recomendações
  sharepoint  String?
  emails      String?
  licencas    String?
  seguranca   String?
  governance  String?
}

