import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcrypt';

const prisma = new PrismaClient();

async function main() {
  console.log("üå± Iniciando Seed do Portal Nitro M365...");

  //
  // =====================================================
  // 1. Criar Analista Administrador
  // =====================================================
  //
  const senhaHash = await bcrypt.hash("nitro123", 10);

  const analista = await prisma.analyst.upsert({
    where: { email: "analista@nitro.com" },
    update: {},
    create: {
      nome: "Analista Nitro",
      email: "analista@nitro.com",
      senha: senhaHash,
      papel: "analista"
    }
  });

  console.log("‚úì Analista criado:", analista.email);

  //
  // =====================================================
  // 2. Criar Cliente Demonstra√ß√£o
  // =====================================================
  //
  const cliente = await prisma.client.upsert({
    where: { dominio: "cliente.com.br" },
    update: {},
    create: {
      nome: "Cliente Demonstra√ß√£o",
      dominio: "cliente.com.br",
      segmento: "Servi√ßos"
    }
  });

  console.log("‚úì Cliente criado:", cliente.nome);

  //
  // =====================================================
  // 3. Criar Projeto Principal
  // =====================================================
  //
  const projeto = await prisma.projeto.create({
    data: {
      nome: "Implanta√ß√£o Microsoft 365 - Cliente Demonstra√ß√£o",
      clienteId: cliente.id,
      descricao: "Projeto de demonstra√ß√£o inicial para testar fluxos e integra√ß√µes.",
      status: "planejamento",
      progresso: 5
    }
  });

  console.log("‚úì Projeto criado:", projeto.nome);

  //
  // =====================================================
  // 4. Criar Levantamento (14 servi√ßos)
  // =====================================================
  //
  const servicos = [
    { nome: "Exchange Online", categoria: "Email", criticidade: "Alta", tempoEstimado: 8 },
    { nome: "SharePoint Online", categoria: "Colabora√ß√£o", criticidade: "Alta", tempoEstimado: 20 },
    { nome: "Teams", categoria: "Comunica√ß√£o", criticidade: "Alta", tempoEstimado: 12 },
    { nome: "OneDrive", categoria: "Armazenamento", criticidade: "M√©dia", tempoEstimado: 6 },
    { nome: "Azure AD / Entra ID", categoria: "Identidade", criticidade: "Alta", tempoEstimado: 15 },
    { nome: "Seguran√ßa e Compliance", categoria: "Seguran√ßa", criticidade: "Alta", tempoEstimado: 10 },
    { nome: "Intune", categoria: "Gerenciamento", criticidade: "M√©dia", tempoEstimado: 16 },
    { nome: "Planner / Tasks", categoria: "Produtividade", criticidade: "Baixa", tempoEstimado: 3 },
    { nome: "Forms / Power Automate", categoria: "Automa√ß√£o", criticidade: "M√©dia", tempoEstimado: 8 },
    { nome: "Viva", categoria: "Engajamento", criticidade: "Baixa", tempoEstimado: 5 },
    { nome: "Yammer", categoria: "Comunica√ß√£o", criticidade: "Baixa", tempoEstimado: 2 },
    { nome: "Compliance Manager", categoria: "Seguran√ßa", criticidade: "Alta", tempoEstimado: 6 },
    { nome: "DLP / Etiquetas Sens√≠veis", categoria: "Seguran√ßa", criticidade: "Alta", tempoEstimado: 10 },
    { nome: "Governan√ßa de Grupos", categoria: "Administra√ß√£o", criticidade: "M√©dia", tempoEstimado: 5 }
  ];

  for (const s of servicos) {
    await prisma.levantamento.create({
      data: {
        projetoId: projeto.id,
        ...s
      }
    });
  }

  console.log("‚úì Levantamento criado (14 itens)");

  //
  // =====================================================
  // 5. Configura√ß√£o de Licenciamento
  // =====================================================
  //
  await prisma.licenciamento.create({
    data: {
      projetoId: projeto.id,
      m365basic: 10,
      m365standard: 30,
      appsforbusiness: 5,
      f3: 0,
      e3: 2,
      e5: 1,
      observacoes: "Modelo demonstrativo inicial."
    }
  });

  console.log("‚úì Licenciamento configurado");

  //
  // =====================================================
  // 6. Orienta√ß√µes Nitro (conte√∫dos padr√£o)
  // =====================================================
  //
  await prisma.orientacao.create({
    data: {
      projetoId: projeto.id,

      teams: `
<h2>Boas pr√°ticas do Microsoft Teams</h2>
<ul>
  <li>Criar equipes por departamento.</li>
  <li>Usar canais padr√£o para organiza√ß√£o interna.</li>
  <li>Evitar enviar arquivos no chat ‚Äî usar canais.</li>
  <li>Manter dois propriet√°rios por equipe.</li>
</ul>`,

      sharepoint: `
<h2>Padr√£o de Sites SharePoint</h2>
<p>Recomendamos a cria√ß√£o de um site por departamento com bibliotecas organizadas por processos.</p>
`,

      emails: `
<h2>Migra√ß√£o de Email</h2>
<ul>
  <li>Revisar tamanho das caixas.</li>
  <li>Verificar encaminhamentos ativos.</li>
  <li>Criar janela de migra√ß√£o.</li>
</ul>`,

      licencas: `
<h2>Modelos de Licenciamento</h2>
<p>Standard √© a op√ß√£o recomendada como padr√£o Nitro.</p>
`,

      seguranca: `
<h2>Seguran√ßa</h2>
<ul>
  <li>MFA obrigat√≥rio.</li>
  <li>Hardening com Pol√≠ticas de Acesso Condicional.</li>
  <li>Bloqueio de legados.</li>
</ul>`,

      governance: `
<h2>Governan√ßa</h2>
<p>Estrutura de cria√ß√£o controlada de Teams, propriet√°rios, ciclo de vida e pol√≠ticas de expira√ß√£o.</p>
`
    }
  });

  console.log("‚úì Orienta√ß√µes Nitro adicionadas");

  //
  // =====================================================
  // 7. Conclu√≠do
  // =====================================================
  //
  console.log("üå± Seed conclu√≠do com sucesso!");
}

main()
  .catch((e) => {
    console.error("‚ùå Erro no seed:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });

